## **ЁЯЫбя╕П PHP CSRF Protection: Cross-Site Request Forgery (CSRF) ржкрзНрж░рждрж┐рж░рзЛржз**

**Cross-Site Request Forgery (CSRF)** ржЖржХрзНрж░ржоржг рж╣рж▓рзЛ ржПржХржЯрж┐ ржзрж░ржирзЗрж░ ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржжрзБрж░рзНржмрж▓рждрж╛ ржпрзЗржЦрж╛ржирзЗ ржЖржХрзНрж░ржоржгржХрж╛рж░рзА **ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржХрзЗ ржЕржирж┐ржЪрзНржЫрж╛ржХрзГрждржнрж╛ржмрзЗ** ржПржоржи ржХрзЛржирзЛ ржХрзНрж░рж┐рзЯрж╛ржХрж▓рж╛ржкрзЗ ржмрж╛ржзрзНржп ржХрж░рзЗ ржпрж╛рж░ ржлрж▓рзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржХрзЗ **ржЕржирзНржпрзЗрж░ ржЕрзНржпрж╛ржХрж╛ржЙржирзНржЯрзЗ ржХрзНрж╖рждрж┐ржХрж░ ржХрж╛рж░рзНржпржХрж▓рж╛ржк** ржХрж░рждрзЗ рж╣рзЯред 

### **ЁЯЪи CSRF ржЖржХрзНрж░ржоржгрзЗрж░ ржЙржжрж╛рж╣рж░ржг:**
ржзрж░рж╛ ржпрж╛ржХ, ржПржХржЯрж┐ ржУрзЯрзЗржмрж╕рж╛ржЗржЯрзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА рж▓ржЧ ржЗржи ржХрж░рзЗржЫрзЗржи ржПржмржВ ржПржХржЯрж┐ ржмрж╛ржЯржи ржХрзНрж▓рж┐ржХ ржХрж░рж╛рж░ ржорж╛ржзрзНржпржорзЗ ржлрж░рзНржо рж╕рж╛ржмржорж┐ржЯ ржХрж░рж╛ рж╣рзЯ:
```php
<form method="POST" action="delete_account.php">
    <input type="submit" value="Delete Account">
</form>
```
ржПржХржЬржи ржЖржХрзНрж░ржоржгржХрж╛рж░рзА ржпржжрж┐ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзАржХрзЗ ржПржХ ржкрзЗржЬрзЗ ржирж┐рзЯрзЗ ржЧрж┐рзЯрзЗ ржирж┐ржорзНржирж▓рж┐ржЦрж┐ржд ржлрж░рзНржоржЯрж┐ ржЪрж╛рж▓рж┐рзЯрзЗ ржжрзЗрзЯ, рждржмрзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржЬрж╛ржирждрзЗржУ ржкрж╛рж░рзЗ ржирж╛ ржпрзЗ рждрж╛ржжрзЗрж░ ржЕрзНржпрж╛ржХрж╛ржЙржирзНржЯ ржорзБржЫрзЗ ржпрж╛ржЪрзНржЫрзЗ:
```html
<form method="POST" action="delete_account.php">
    <input type="submit" value="Delete Account">
</form>
```
ржпрзЗрж╣рзЗрждрзБ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржЗрждрж┐ржоржзрзНржпрзЗ рж▓ржЧ ржЗржи ржЖржЫрзЗржи, рждрж╛рж░рж╛ ржПржЗ ржЕржирзБрж░рзЛржзрзЗрж░ ржорж╛ржзрзНржпржорзЗ ржЕржмржЪрзЗрждржиржнрж╛ржмрзЗ ржПржХрзНржЯрж┐ржн рж╣ржмрзЗред

---

## **тЬЕ 1я╕ПтГг CSRF ржЖржХрзНрж░ржоржг ржерзЗржХрзЗ рж╕рзБрж░ржХрзНрж╖рж╛ ржирзЗржУрзЯрж╛рж░ ржкржжрзНржзрждрж┐:**

### **ЁЯЪА Solution 1: CSRF Token ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛**

CSRF ржЖржХрзНрж░ржоржг ржкрзНрж░рждрж┐рж░рзЛржзрзЗрж░ **рж╕ржмржЪрзЗрзЯрзЗ ржХрж╛рж░рзНржпржХрж░рзА** ржкржжрзНржзрждрж┐ рж╣рж▓рзЛ **CSRF Token** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ред 

#### **CSRF Token ржХрзА?**
- ржПржЯрж┐ ржПржХржЯрж┐ ржПржХрзНрж╕ржЯрзНрж░рж╛ рж╕рж┐ржХрж┐ржЙрж░рж┐ржЯрж┐ **ржЯрзЛржХрзЗржи** ржпрж╛ **ржлрж░рзНржорзЗрж░ рж╕рж╛ржерзЗ** ржкрж╛ржарж╛ржирзЛ рж╣рзЯред ржПржЗ ржЯрзЛржХрзЗржи рж╕ржарж┐ржХ рж╣рж▓рзЗ рждржмрзЗржЗ ржлрж░рзНржорзЗрж░ ржбрзЗржЯрж╛ ржЧрзНрж░рж╣ржг ржХрж░рж╛ рж╣рзЯред
- **рж╕рж╛рж░рзНржнрж╛рж░** ржпрзЗржХрзЛржирзЛ **ржлрж░рзНржо рж╕рж╛ржмржорж┐рж╢ржи** ржерзЗржХрзЗ ржПржХржЯрж┐ рж░рзНржпрж╛ржирзНржбржо ржЯрзЛржХрзЗржи рждрзИрж░рж┐ ржХрж░рзЗ ржПржмржВ **ржПржЯрж┐ ржлрж░рзНржорзЗрж░ ржоржзрзНржпрзЗ** рж╕ржирзНржирж┐ржмрзЗрж╢рж┐ржд ржХрж░рзЗред
- ржпржЦржи ржлрж░рзНржоржЯрж┐ рж╕рж╛ржмржорж┐ржЯ рж╣рзЯ, **рж╕рж╛рж░рзНржнрж╛рж░ ржЯрзЛржХрзЗржи** ржЪрзЗржХ ржХрж░рзЗ ржПржмржВ **ржорзЗрж▓ ржирж╛ ржЦрзЗрж▓рзЗ** ржлрж░рзНржо ржЧрзНрж░рж╣ржг ржХрж░рзЗржирж╛ред

#### **CSRF Token рждрзИрж░рж┐ ржУ ржпрж╛ржЪрж╛ржЗ:**

1. **Token рждрзИрж░рж┐**:  
ржлрж░рзНржо рж╕рж╛ржмржорж┐ржЯрзЗрж░ ржЬржирзНржп **CSRF token** рждрзИрж░рж┐ ржХрж░рждрзЗ **PHP session** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣рзЯред
   
```php
// Start the session
session_start();

// Create a random token
$_SESSION['csrf_token'] = bin2hex(random_bytes(32));
```

2. **Token ржлрж░рзНржорзЗ ржпрзБржХрзНржд ржХрж░рж╛**:  
ржлрж░рзНржорзЗрж░ ржПржХржЯрж┐ **hidden input** ржлрж┐рж▓рзНржбрзЗ **CSRF token** ржЕржирзНрждрж░рзНржнрзБржХрзНржд ржХрж░рзБржиред

```php
<form method="POST" action="submit_form.php">
    <input type="hidden" name="csrf_token" value="<?php echo $_SESSION['csrf_token']; ?>">
    <input type="text" name="user_input">
    <input type="submit" value="Submit">
</form>
```

3. **Token ржпрж╛ржЪрж╛ржЗ ржХрж░рж╛**:  
ржлрж░рзНржо ржЬржорж╛ рж╣ржУрзЯрж╛рж░ ржкрж░ **PHP** ржХрзЛржбрзЗ CSRF ржЯрзЛржХрзЗржи ржпрж╛ржЪрж╛ржЗ ржХрж░рж╛ рж╣рзЯред

```php
session_start();

if ($_SERVER["REQUEST_METHOD"] === "POST") {
    // Check if CSRF token is valid
    if (!isset($_POST['csrf_token']) || $_POST['csrf_token'] !== $_SESSION['csrf_token']) {
        die("CSRF attack detected!");
    }
    // Process the form data
}
```
тЬЕ **ржПржЗ ржкржжрзНржзрждрж┐ CSRF ржЖржХрзНрж░ржоржг ржерзЗржХрзЗ рж╕рзБрж░ржХрзНрж╖рж╛ ржжрзЗрзЯ ржХрж╛рж░ржг ржЖржХрзНрж░ржоржгржХрж╛рж░рзА ржУржЗ ржЯрзЛржХрзЗржи ржкрзЗрждрзЗ ржкрж╛рж░рзЗ ржирж╛ред**

---

### **ЁЯЪА Solution 2: SameSite Cookie Attribute**

ржмрзНрж░рж╛ржЙржЬрж╛рж░ржжрзЗрж░ ржирждрзБржи **`SameSite`** ржХрзБржХрж┐ ржЕрзНржпрж╛ржЯрзНрж░рж┐ржмрж┐ржЙржЯ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ CSRF ржЖржХрзНрж░ржоржг ржкрзНрж░рждрж┐рж░рзЛржз ржХрж░рж╛ рж╕ржорзНржнржмред ржПржЯрж┐ ржХрзБржХрж┐ рж╢рзБржзрзБржорж╛рждрзНрж░ рждржЦржи ржкрж╛ржарж╛ржирзЛ рж╣ржмрзЗ ржпржЦржи ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржУржЗ рж╕рж╛ржЗржЯрзЗ ржерж╛ржХржмрзЗ ржПржмржВ **Cross-Site** ржЕржирзБрж░рзЛржз ржерзЗржХрзЗ ржХрзБржХрж┐ рж░рзЛржз ржХрж░ржмрзЗред

#### **SameSite Cookie Example:**
```php
// Set SameSite cookie
setcookie("user_session", $session_value, time() + 3600, "/", "", false, true);
```
- **SameSite=Strict**: ржХрзБржХрж┐ рж╢рзБржзрзБржорж╛рждрзНрж░ ржпржЦржи ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржУржЗ рж╕рж╛ржЗржЯрзЗ ржерж╛ржХржмрзЗржи, рждржЦржиржЗ ржкрж╛ржарж╛ржирзЛ рж╣ржмрзЗред
- **SameSite=Lax**: ржХрж┐ржЫрзБ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржЕржмрж╕рзНржерж╛ ржЫрж╛рзЬрж╛ ржЕржирзНржп рж╕рж╛ржЗржЯрзЗ ржХрзБржХрж┐ ржкрж╛ржарж╛ржирзЛ рж╣ржмрзЗ ржирж╛ред

---

### **ЁЯЪА Solution 3: Double Submit Cookie Method**

ржПржЗ ржкржжрзНржзрждрж┐рждрзЗ, **CSRF token** ржлрж░рзНржорзЗрж░ ржоржзрзНржпрзЗ ржкрж╛ржарж╛ржирзЛ рж╣рзЯ, ржПржмржВ ржПржХржЗ **token** ржХрзБржХрж┐рждрзЗ рж╕ржВрж░ржХрзНрж╖рж┐ржд ржерж╛ржХрзЗред ржлрж░рзНржо рж╕рж╛ржмржорж┐ржЯрзЗрж░ рж╕ржорзЯ, **ржЯрзЛржХрзЗржи ржжрзБржЯрж┐ ржЬрж╛рзЯржЧрж╛рзЯ ржорж┐рж▓рж╛ржирзЛ** рж╣рзЯ (ржлрж░рзНржо ржПржмржВ ржХрзБржХрж┐)ред

#### **Example:**

1. **Token рждрзИрж░рж┐ ржУ ржХрзБржХрж┐рждрзЗ рж╕рзЗржЯ ржХрж░рж╛**:
```php
session_start();
$_SESSION['csrf_token'] = bin2hex(random_bytes(32));
setcookie("csrf_token", $_SESSION['csrf_token'], time() + 3600, "/", "", false, true);
```

2. **Token ржпрж╛ржЪрж╛ржЗ**:
```php
session_start();

if ($_SERVER["REQUEST_METHOD"] === "POST") {
    if (!isset($_POST['csrf_token']) || $_POST['csrf_token'] !== $_COOKIE['csrf_token']) {
        die("CSRF attack detected!");
    }
    // Process the form data
}
```
тЬЕ **ржПржЯрж┐ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзЗ ржпрзЗ ржлрж░рзНржо рж╕рж╛ржмржорж┐рж╢ржи ржмрзИржз рж╣рж▓рзЗ ржПржмржВ ржПржХржЯрж┐ржЗ ржЯрзЛржХрзЗржи ржкрж╛ржУржпрж╝рж╛ ржЧрзЗрж▓рзЗ, рж╢рзБржзрзБржорж╛рждрзНрж░ рждржЦржиржЗ ржлрж░рзНржо ржЧрзНрж░рж╣ржг ржХрж░рж╛ рж╣ржмрзЗред**

---

## **тЬЕ 2я╕ПтГг CSRF ржЖржХрзНрж░ржоржг рж╢ржирж╛ржХрзНржд ржХрж░рж╛рж░ ржкржжрзНржзрждрж┐**

1. **Cross-Origin Requests**: ржбрзЗржнрзЗрж▓ржкрж╛рж░рж░рж╛ ржпржжрж┐ ржмрзБржЭрждрзЗ ржкрж╛рж░рзЗржи ржпрзЗ **ржПржХржЯрж┐ ржЕржирзИрждрж┐ржХ рж╕рж╛ржЗржЯ** рждрж╛ржжрзЗрж░ рж╕рж╛ржЗржЯрзЗ ржЕржирзБрж░рзЛржз ржкрж╛ржарж╛ржЪрзНржЫрзЗ, рждржЦржи рждрж╛рж░рж╛ ржУржЗ ржЕржирзБрж░рзЛржзржЧрзБрж▓рж┐ржХрзЗ ржмрзНрж▓ржХ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред
2. **Token Validation**: ржлрж░рзНржорзЗ **CSRF ржЯрзЛржХрзЗржи** рж╕ржарж┐ржХржнрж╛ржмрзЗ ржпрж╛ржЪрж╛ржЗ ржХрж░рж╛ рж╣рзЯ ржХрж┐ржирж╛ рждрж╛ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рж╛ред

---

## **тЬЕ 3я╕ПтГг рж╕рж╛рж░рзНржмрж┐ржХ ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржмрж┐ржзрж╛ржи**

- **Ensure HTTPS**: CSRF ржЖржХрзНрж░ржоржг ржерзЗржХрзЗ ржирж┐рж░рж╛ржкржж ржерж╛ржХрждрзЗ **HTTPS** ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржорж╛ржзрзНржпржорзЗ **рждржерзНржп ржПржиржХрзНрж░рж┐ржкрзНржЯ** ржХрж░рзБржиред
- **Set Content Security Policy (CSP)**: CSP ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж▓рзЗ ржЖржХрзНрж░ржоржгржХрж╛рж░рзАрж░ ржкржХрзНрж╖рзЗ ржХрзНрж░рж╕ рж╕рж╛ржЗржЯ рж╕рзНржХрзНрж░рж┐ржкрзНржЯрж┐ржВ (XSS) ржПржмржВ CSRF ржЖржХрзНрж░ржоржг ржХрж░рж╛ ржХржарж┐ржи рж╣ржмрзЗред
- **Session Fixation Prevention**: **рж╕рзЗрж╢ржи ржЖржЗржбрж┐** ржкрзНрж░рждрж┐ рж▓ржЧржЗржирзЗржЗ ржкрж░рж┐ржмрж░рзНрждржи ржХрж░рзБржиред

---

## **ЁЯЪА рж╕рж╛рж░рж╕ржВржХрзНрж╖рзЗржк**

| **CSRF Protection Technique** | **What it does**                                            |
| ----------------------------- | ----------------------------------------------------------- |
| **CSRF Token**                | Random token generated and checked for each form submission |
| **SameSite Cookie Attribute** | Prevents cookies from being sent in cross-site requests     |
| **Double Submit Cookie**      | CSRF token in both form and cookie, ensuring they match     |
| **HTTPS**                     | Ensures data is encrypted during transfer                   |
| **Content Security Policy**   | Controls allowed sources of content                         |

---

## **ЁЯЪА ржкрж░ржмрж░рзНрждрзА ржзрж╛ржк**
CSRF рж╕ржорзНржкрж░рзНржХрзЗ ржЖрж░ржУ ржЬрж╛ржирж╛рж░ ржЖржЧрзНрж░рж╣ ржЖржЫрзЗ? **PHP Security** ржирж┐рзЯрзЗ ржЕржирзНржпрж╛ржирзНржп ржмрж┐рж╖рзЯ рж╢рж┐ржЦрждрзЗ ржЪрж╛ржЗ?

ЁЯСЙ ржЖржорж╛ржХрзЗ ржмрж▓рзЛ, ржЖржорж┐ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░рждрзЗ ржкрж╛рж░рж┐! ЁЯШК