## **ЁЯФ╣ PHP Database Transactions рж╕ржорзНржкрзВрж░рзНржг ржЧрж╛ржЗржб**  

### **тЬЕ Database Transaction ржХрзА?**  
**Database Transaction** рж╣рж▓ ржПржХрж╛ржзрж┐ржХ ржбрж╛ржЯрж╛ржмрзЗржЬ ржЕржкрж╛рж░рзЗрж╢ржиржХрзЗ ржПржХржЯрж┐ ржЗржЙржирж┐ржЯ рж╣рж┐рж╕рзЗржмрзЗ ржПржХрзНрж╕рж┐ржХрж┐ржЙржЯ ржХрж░рж╛рж░ ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛ред ржпржжрж┐ рж╕ржмржЧрзБрж▓рзЛ ржЕржкрж╛рж░рзЗрж╢ржи рж╕ржлрж▓ рж╣ржпрж╝, рждрж╛рж╣рж▓рзЗ ржбрж╛ржЯрж╛ржмрзЗржЬрзЗ ржЪрзЗржЮрзНржЬ **Commit** ржХрж░рж╛ рж╣ржпрж╝ред ржЖрж░ ржпржжрж┐ ржХрзЛржирзЛ ржПржХржЯрж┐ ржЕржкрж╛рж░рзЗрж╢ржи ржмрзНржпрж░рзНрже рж╣ржпрж╝, рждрж╛рж╣рж▓рзЗ рж╕ржмржХрж┐ржЫрзБ **Rollback** ржХрж░рж╛ рж╣ржпрж╝, ржпрж╛рждрзЗ ржбрж╛ржЯрж╛ржмрзЗржЬ ржЗржиржХржирж╕рж┐рж╕рзНржЯрзЗржирзНржЯ ржирж╛ рж╣ржпрж╝ред  

### **тЬЕ Transactions-ржПрж░ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржмрзИрж╢рж┐рж╖рзНржЯрзНржп (ACID Properties)**  
1я╕ПтГг **Atomicity:** рж╕ржм ржЕржкрж╛рж░рзЗрж╢ржи рж╕ржлрж▓ рж╣ржмрзЗ ржЕржержмрж╛ ржХрж┐ржЫрзБржЗ рж╣ржмрзЗ ржирж╛ред  
2я╕ПтГг **Consistency:** ржЯрзНрж░рж╛ржиржЬрзНржпрж╛ржХрж╢ржи рж╕ржлрж▓ рж╣рж▓рзЗ ржбрж╛ржЯрж╛ржмрзЗржЬ ржХржирж╕рж┐рж╕рзНржЯрзЗржирзНржЯ ржерж╛ржХржмрзЗред  
3я╕ПтГг **Isolation:** ржПржХрж╛ржзрж┐ржХ ржЯрзНрж░рж╛ржиржЬрзНржпрж╛ржХрж╢ржи ржПржХрзЗ ржЕржкрж░ржХрзЗ ржкрзНрж░ржнрж╛ржмрж┐ржд ржХрж░ржмрзЗ ржирж╛ред  
4я╕ПтГг **Durability:** ржЯрзНрж░рж╛ржиржЬрзНржпрж╛ржХрж╢ржи ржХржоржкрзНрж▓рж┐ржЯ рж╣рж▓рзЗ ржбрж╛ржЯрж╛ ржкрж╛рж░рзНржорж╛ржирзЗржирзНржЯ рж╣рзЯрзЗ ржпрж╛ржмрзЗред  

---

# **ЁЯФ╣ 1я╕ПтГг MySQLi ржжрж┐рзЯрзЗ Database Transactions**
MySQLi ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ Transactions ржЪрж╛рж▓рж╛ржирзЛрж░ ржЬржирзНржп `autocommit(false)`, `commit()`, ржПржмржВ `rollback()` ржорзЗржержб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣рзЯред

### **ЁЯСЙ Example: MySQLi Transaction ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ Multiple Query Execute ржХрж░рж╛**
```php
<?php
$mysqli = new mysqli("localhost", "root", "", "test_db");

// Check connection
if ($mysqli->connect_error) {
    die("Connection failed: " . $mysqli->connect_error);
}

// Turn off autocommit
$mysqli->autocommit(false);

try {
    // ржкрзНрж░ржержо ржХрзБрзЯрзЗрж░рж┐ - ржирждрзБржи ржЗржЙржЬрж╛рж░ рждрзИрж░рж┐
    $mysqli->query("INSERT INTO users (name, email) VALUES ('John Doe', 'john@example.com')");
    
    // ржжрзНржмрж┐рждрзАрзЯ ржХрзБрзЯрзЗрж░рж┐ - ржкрзЗржорзЗржирзНржЯ ржПржирзНржЯрзНрж░рж┐
    $mysqli->query("INSERT INTO payments (user_id, amount) VALUES (LAST_INSERT_ID(), 500)");

    // рж╕ржмржХрж┐ржЫрзБ ржарж┐ржХ ржерж╛ржХрж▓рзЗ Commit
    $mysqli->commit();
    echo "тЬЕ Transaction Successful!";
} catch (Exception $e) {
    // ржпржжрж┐ ржХрзЛржирзЛ рж╕ржорж╕рзНржпрж╛ рж╣рзЯ, рждрж╛рж╣рж▓рзЗ Rollback
    $mysqli->rollback();
    echo "тЭМ Transaction Failed: " . $e->getMessage();
}

// Close connection
$mysqli->close();
?>
```
тЬФ ржПржЦрж╛ржирзЗ ржпржжрж┐ ржкрзНрж░ржержо ржЗржирж╕рж╛рж░рзНржЯ рж╕ржлрж▓ рж╣рзЯ ржХрж┐ржирзНрждрзБ ржжрзНржмрж┐рждрзАрзЯ ржЗржирж╕рж╛рж░рзНржЯ ржмрзНржпрж░рзНрже рж╣рзЯ, рждрж╛рж╣рж▓рзЗ **rollback()** рж╣ржмрзЗ ржПржмржВ ржбрж╛ржЯрж╛ржмрзЗржЬрзЗ ржХрзЛржирзЛ ржкрж░рж┐ржмрж░рзНрждржи рж╣ржмрзЗ ржирж╛ред  

---

# **ЁЯФ╣ 2я╕ПтГг PDO ржжрж┐рзЯрзЗ Database Transactions**
PDO (PHP Data Objects) ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж▓рзЗ ржЯрзНрж░рж╛ржиржЬрзНржпрж╛ржХрж╢ржи рж╣рзНржпрж╛ржирзНржбрзЗрж▓ ржХрж░рж╛ ржЖрж░ржУ рж╕рж╣ржЬ рж╣рзЯред

### **ЁЯСЙ Example: PDO Transaction ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ Multiple Query Execute ржХрж░рж╛**
```php
<?php
try {
    $pdo = new PDO("mysql:host=localhost;dbname=test_db", "root", "");
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);

    // Transaction рж╢рзБрж░рзБ
    $pdo->beginTransaction();

    // ржкрзНрж░ржержо ржХрзБрзЯрзЗрж░рж┐ - ржирждрзБржи ржЗржЙржЬрж╛рж░ рждрзИрж░рж┐
    $stmt1 = $pdo->prepare("INSERT INTO users (name, email) VALUES (:name, :email)");
    $stmt1->execute(['name' => 'Alice', 'email' => 'alice@example.com']);

    // ржжрзНржмрж┐рждрзАрзЯ ржХрзБрзЯрзЗрж░рж┐ - ржкрзЗржорзЗржирзНржЯ ржПржирзНржЯрзНрж░рж┐
    $stmt2 = $pdo->prepare("INSERT INTO payments (user_id, amount) VALUES (LAST_INSERT_ID(), 700)");
    $stmt2->execute();

    // рж╕ржмржХрж┐ржЫрзБ ржарж┐ржХ ржерж╛ржХрж▓рзЗ Commit
    $pdo->commit();
    echo "тЬЕ Transaction Successful!";
} catch (Exception $e) {
    // ржпржжрж┐ ржХрзЛржирзЛ рж╕ржорж╕рзНржпрж╛ рж╣рзЯ, рждрж╛рж╣рж▓рзЗ Rollback
    $pdo->rollBack();
    echo "тЭМ Transaction Failed: " . $e->getMessage();
}
?>
```
тЬФ `beginTransaction()` ржжрж┐рзЯрзЗ рж╢рзБрж░рзБ ржХрж░рж╛ рж╣рзЯ, `commit()` ржжрж┐рзЯрзЗ рж╕ржорзНржкржирзНржи ржХрж░рж╛ рж╣рзЯ, ржЖрж░ ржпржжрж┐ ржХрзЛржирзЛ рж╕ржорж╕рзНржпрж╛ рж╣рзЯ, рждрж╛рж╣рж▓рзЗ `rollBack()` ржХрж░рзЗ рж╕ржм ржкрж░рж┐ржмрж░рзНрждржи ржмрж╛рждрж┐рж▓ ржХрж░рж╛ рж╣рзЯред

---

# **ЁЯФ╣ 3я╕ПтГг Laravel Database Transactions (Eloquent ORM)**
Laravel-ржП **DB Facade** ржмрж╛ **Eloquent Model** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ Transactions ржХрж░рж╛ ржпрж╛рзЯред

### **ЁЯСЙ Example: DB Facade ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ Transactions**
```php
use Illuminate\Support\Facades\DB;

try {
    DB::beginTransaction();

    // ржкрзНрж░ржержо ржХрзБрзЯрзЗрж░рж┐ - ржирждрзБржи ржЗржЙржЬрж╛рж░ рждрзИрж░рж┐
    $userId = DB::table('users')->insertGetId([
        'name' => 'Bob',
        'email' => 'bob@example.com'
    ]);

    // ржжрзНржмрж┐рждрзАрзЯ ржХрзБрзЯрзЗрж░рж┐ - ржкрзЗржорзЗржирзНржЯ ржПржирзНржЯрзНрж░рж┐
    DB::table('payments')->insert([
        'user_id' => $userId,
        'amount' => 900
    ]);

    // рж╕ржмржХрж┐ржЫрзБ ржарж┐ржХ ржерж╛ржХрж▓рзЗ Commit
    DB::commit();
    echo "тЬЕ Transaction Successful!";
} catch (\Exception $e) {
    // ржпржжрж┐ ржХрзЛржирзЛ рж╕ржорж╕рзНржпрж╛ рж╣рзЯ, рждрж╛рж╣рж▓рзЗ Rollback
    DB::rollBack();
    echo "тЭМ Transaction Failed: " . $e->getMessage();
}
```

---

# **ЁЯФ╣ 4я╕ПтГг Laravel Model Transactions (Eloquent ORM)**
Eloquent Model ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗржУ ржЯрзНрж░рж╛ржиржЬрзНржпрж╛ржХрж╢ржи ржЪрж╛рж▓рж╛ржирзЛ ржпрж╛рзЯред

### **ЁЯСЙ Example: Eloquent ORM ржжрж┐рзЯрзЗ Transaction ржЪрж╛рж▓рж╛ржирзЛ**
```php
use App\Models\User;
use App\Models\Payment;
use Illuminate\Support\Facades\DB;

try {
    DB::transaction(function () {
        // ржкрзНрж░ржержо ржХрзБрзЯрзЗрж░рж┐ - ржирждрзБржи ржЗржЙржЬрж╛рж░ рждрзИрж░рж┐
        $user = User::create([
            'name' => 'Charlie',
            'email' => 'charlie@example.com'
        ]);

        // ржжрзНржмрж┐рждрзАрзЯ ржХрзБрзЯрзЗрж░рж┐ - ржкрзЗржорзЗржирзНржЯ ржПржирзНржЯрзНрж░рж┐
        Payment::create([
            'user_id' => $user->id,
            'amount' => 1200
        ]);
    });

    echo "тЬЕ Transaction Successful!";
} catch (\Exception $e) {
    echo "тЭМ Transaction Failed: " . $e->getMessage();
}
```
тЬФ **`DB::transaction()`** ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж▓рзЗ Laravel ржирж┐ржЬрзЗржЗ `commit()` ржПржмржВ `rollback()` рж╣рзНржпрж╛ржирзНржбрзЗрж▓ ржХрж░рзЗред

---

# **ЁЯФ╣ Laravel Transactions-ржПрж░ Shortcuts**
Laravel-ржП `DB::transaction()` ржлрж╛ржВрж╢ржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж▓рзЗ рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ржнрж╛ржмрзЗ Commit ржмрж╛ Rollback рж╣рзЯред
```php
DB::transaction(function () {
    User::create(['name' => 'David', 'email' => 'david@example.com']);
    Payment::create(['user_id' => 1, 'amount' => 1500]);
});
```
тЬФ ржпржжрж┐ ржХрзЛржирзЛ ржПрж░рж░ рж╣рзЯ, рждрж╛рж╣рж▓рзЗ **Rollback** рж╣ржмрзЗ, ржирж╛рж╣рж▓рзЗ **Commit** рж╣ржмрзЗред

---

# **ЁЯФ╣ Transactions Best Practices**
тЬФ **ржПржХржЗ ржЯрзНрж░рж╛ржиржЬрзНржпрж╛ржХрж╢ржирзЗ ржЕржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржХрзБрзЯрзЗрж░рж┐ рж░рж╛ржЦржмрзЗржи ржирж╛ред**  
тЬФ **Transaction рж╕рж░рзНржмржжрж╛ try-catch ржмрзНрж▓ржХрзЗрж░ ржоржзрзНржпрзЗ рж░рж╛ржЦрзБржиред**  
тЬФ **PDO ржмрж╛ Laravel-ржПрж░ `DB::transaction()` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ ржмрзЗрж╕рзНржЯред**  
тЬФ **SQL Injection ржПрзЬрж╛рждрзЗ `prepare()` ржмрж╛ `bindParam()` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржиред**  
тЬФ **Eloquent Model-ржПрж░ ржорж╛ржзрзНржпржорзЗ ржбрж╛ржЯрж╛ржмрзЗржЬ ржЕржкрж╛рж░рзЗрж╢ржи ржХрж░рж▓рзЗ ржХрзЛржб ржХрзНрж▓рж┐ржи ржУ рж░рж┐ржбрзЗржмрж▓ рж╣рзЯред**  

---

## **ЁЯФ╣ рж╕ржВржХрзНрж╖рзЗржкрзЗ Transactions-ржПрж░ рж╕рзБржмрж┐ржзрж╛**
тЬЕ **ржбрж╛ржЯрж╛ржмрзЗржЬ ржХржирж╕рж┐рж╕рзНржЯрзЗржирзНрж╕рж┐ ржмржЬрж╛ржпрж╝ рж░рж╛ржЦрзЗред**  
тЬЕ **рждрзНрж░рзБржЯрж┐ржкрзВрж░рзНржг ржбрж╛ржЯрж╛ржмрзЗржЬ ржПржирзНржЯрзНрж░рж┐ ржкрзНрж░рждрж┐рж░рзЛржз ржХрж░рзЗред**  
тЬЕ **SQL Injection ржкрзНрж░рждрж┐рж░рзЛржз ржХрж░рзЗред**  
тЬЕ **ржПржХрж╛ржзрж┐ржХ ржбрж╛ржЯрж╛ржмрзЗржЬ ржЕржкрж╛рж░рзЗрж╢ржи ржПржХржЯрж┐ ржЗржЙржирж┐ржЯ рж╣рж┐рж╕рзЗржмрзЗ ржПржХрзНрж╕рж┐ржХрж┐ржЙржЯ ржХрж░рж╛ ржпрж╛рзЯред**  

Laravel ржмрж╛ PDO ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж▓рзЗ Database Transactions ржЖрж░ржУ рж╕рж╣ржЬ ржУ ржирж┐рж░рж╛ржкржж рж╣рзЯред ЁЯЪА